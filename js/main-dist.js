var app=angular.module("app",["ui.router","ngSanitize","ngAnimate","angular-images-loaded"]).controller("MainController");app.directive("contentView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent.html",element.html())}}}]),app.directive("preloadResource",["resourceCache",function(resourceCache){return{link:function(scope,element,attrs){resourceCache.put(attrs.preloadResource,element.html())}}}]),app.directive("onLastRepeat",function(){return function(scope,element,attrs){scope.$last&&setTimeout(function(){scope.$emit("onRepeatLast",element,attrs)},1)}}),app.run(function($templateCache,$http,resourceCache){$templateCache.put("indexview.html",'<div id="primary" class="content-area"><main id="main" class="site-main" role="main"><div class="index-view" index-view ui-view="indexView" autoscroll="false"><div class="site-description" ng-bind-html="data.home.content"></div><div class="grid"><div class="grid-sizer"></div><div class="gutter-sizer"></div><div class="grid-item" ng-repeat="postitem in data.posts" on-last-repeat><a href="{{data.postitem.link}}" rel="bookmark"><img width="{{data.postitem.featured_image.attachment_meta.width}}" height="{{data.postitem.featured_image.attachment_meta.height}}" src="{{data.postitem.featured_image.source}}" alt="{{data.postitem.title}}"><h1 class="entry-title">{{data.postitem.title}}</h1><div class="entry-details">{{data.postitem.acf.entry_details}}</div></a></div></div></div><div class="post-view" post-view ui-view="postView"></div></main></div>'),$templateCache.put("postview.html",'<article id="post-{{data.post.ID}}" class="post-{{data.post.ID}} {{data.post.type}} type-{{data.post.type}}"><header class="entry-header"><h1 class="entry-title">{{data.post.title}}</h1><div class="entry-details">{{data.post.acf.entry_details}}</div></header><div class="entry-content" ng-bind-html="data.post.content"></div></article>'),$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache})}),app.controller("MainController",["$scope","$rootScope","$state","$location","$timeout","$anchorScroll","stateStatusService",function($scope,$rootScope,$state,$location,$timeout,$anchorScroll,stateStatusService){$rootScope.$on("$stateChangeStart",function(){console.log("set saveScroll temporarily false"),stateStatusService.saveScroll(!1)}),$rootScope.$on("$stateChangeSuccess",function(event,toState){stateStatusService.startState()||(stateStatusService.startState(toState.name),console.log("Start state is... "+stateStatusService.startState())),stateStatusService.currentState(toState.name),"index"==stateStatusService.currentState()?(stateStatusService.indexLoaded(!0)||stateStatusService.indexLoaded(!0),$("body").removeClass("single")):$("body").addClass("single")}),$scope.imgLoadedEvents={always:function(){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded");new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})},fail:function(){}},$scope.gotoTop=function(){$scope.currentPath=$location.path(),"/"==$scope.currentPath&&(stateStatusService.scrollPos(0),$("html,body").animate({scrollTop:0},500))}}]),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/",resolve:{indexTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?stateStatusService.indexLoaded()?void console.log("Index already has been loaded so skip resolve part"):(console.log("get indexview.html (json)"),$templateRequest("indexview.html")):(console.log("get initialcontent.html (php)"),$templateRequest("initialcontent.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getIndex():(console.log("initDataFromJSON (index state)"),void stateStatusService.initDataFromJSON())}},views:{"contentView@":{templateProvider:function(indexTemplateCacheOrInitialContent,stateStatusService){return stateStatusService.indexLoaded()?void console.log("Index already has been loaded so skip view part"):(console.log("IndexLoaded: "+stateStatusService.indexLoaded()),indexTemplateCacheOrInitialContent)},controller:"IndexController"}}}).state("post",{url:"/:slug/",resolve:{postTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?(console.log("get postview.html (json)"),$templateRequest("postview.html")):(console.log("get initialcontent.html (php)"),$templateRequest("initialcontent.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getPost($stateParams.slug):(console.log("initDataFromJSON (post state)"),void stateStatusService.initDataFromJSON())}},views:{"postView@":{templateProvider:function(postTemplateCacheOrInitialContent){return postTemplateCacheOrInitialContent},controller:"PostController"}}})}),app.controller("IndexController",["$scope","promiseObj","$timeout","$anchorScroll",function($scope,promiseObj){promiseObj&&($scope.data=promiseObj)}]),app.controller("PostController",["$scope","promiseObj",function($scope,promiseObj){promiseObj&&($scope.data=promiseObj)}]),app.factory("resourceCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("resourceCache")}]),app.factory("wpService",["$http","$q","$stateParams","resourceCache",function($http,$q,$stateParams,resourceCache){var wpService={post:[],posts:[],pages:[],home:[]};return wpService.getIndex=function(){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){"Home"==res[postkey].title?(wpService.home=res[postkey],document.querySelector("title").innerHTML="Johan Bisse Mattsson"):res[postkey].slug==$stateParams.slug&&(wpService.posts=res[postkey])}),wpService.posts=res}).then(function(){return wpService})},wpService.getPost=function(slug){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){res[postkey].slug==slug&&(wpService.post=res[postkey],document.querySelector("title").innerHTML=res[postkey].title+" | Johan Bisse Mattsson")})}).then(function(){return wpService})},wpService}]),app.service("stateStatusService",function(){var stringStartState,stringCurrentState,boolDataFromJSON=!1,boolIndexLoaded=!1,boolSaveScroll=!0,intScrollPos=0;return{startState:function(value){return value?void(stringStartState=value):stringStartState},dataFromJSON:function(){return boolDataFromJSON},initDataFromJSON:function(){boolDataFromJSON=!0},indexLoaded:function(value){return value?void(boolIndexLoaded=value):boolIndexLoaded},saveScroll:function(value){return value?void(boolSaveScroll=value):boolSaveScroll},scrollPos:function(value){return value?void(intScrollPos=value):intScrollPos},currentState:function(value){return value?void(stringCurrentState=value):stringCurrentState}}});
