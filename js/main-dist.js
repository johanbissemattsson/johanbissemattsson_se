var app=angular.module("app",["ui.router","ct.ui.router.extras","ngSanitize","ngAnimate"]).controller("MainController");app.directive("contentView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent.html",element.html())}}}]),app.directive("indexView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("indexview-initialcontent.html",element.html())}}}]),app.directive("postView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("postview-initialcontent.html",element.html())}}}]),app.directive("preloadResource",["resourceCache",function(resourceCache){return{link:function(scope,element,attrs){resourceCache.put(attrs.preloadResource,element.html())}}}]),app.directive("onLastRepeat",function(){return function(scope,element,attrs){scope.$last&&setTimeout(function(){scope.$emit("onRepeatLast",element,attrs)},1)}}),app.run(function($templateCache,$http,resourceCache){$templateCache.put("indexview.html",'<div class="site-description" ng-bind-html="data.home.content"></div><div class="grid"><div class="grid-item" ng-repeat="postitem in data.posts" on-last-repeat><a href="{{postitem.link}}" rel="bookmark" ng-click="onPostItemClick(postitem)" ng-class="{selected : isSelected(postitem)}"><img ng-src="{{postitem.featured_image.source}}" width="{{postitem.featured_image.attachment_meta.width}}" height="{{postitem.featured_image.attachment_meta.height}}" alt="{{postitem.title}}" class="attachment-{{postitem.slug}}-thumbnail"><h1 class="entry-title">{{postitem.title}}</h1> <span class="entry-details">{{postitem.acf.entry_details}}</span></a></div>'),$templateCache.put("postview.html",'<article id="post-{{data.post.ID}}" class="post-{{data.post.ID}} {{data.post.type}} type-{{data.post.type}}"><header class="entry-header"><h1 class="entry-title">{{data.post.title}}</h1><span class="entry-details">{{data.post.acf.entry_details}}</span><div class="featured-image"><img ng-src="{{data.post.featured_image.source}}" width="{{data.post.featured_image.attachment_meta.width}}" height="{{data.post.featured_image.attachment_meta.height}}" alt="{{data.post.title}}"></div><div class="animate-featured-image"><img ng-src="{{data.post.featured_image.source}}" width="{{data.post.featured_image.attachment_meta.width}}" height="{{data.post.featured_image.attachment_meta.height}}"></div></header><div class="entry-content" ng-bind-html="data.post.content"></div></article>'),$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache})}),app.controller("MainController",["$scope","$rootScope","$state","$location","$timeout","$anchorScroll","stateStatusService",function($scope,$rootScope,$state,$location,$timeout,$anchorScroll,stateStatusService){$scope.$on("$stateChangeSuccess",function(event,toState){stateStatusService.startState()?console.log("Current state is: "+toState.name):(stateStatusService.startState(toState.name),console.log("Start state is: "+stateStatusService.startState()))}),$scope.gotoTop=function(){$scope.currentPath=$location.path(),"/"==$scope.currentPath&&(stateStatusService.scrollPos(0),TweenMax.to(window,.5,{scrollTo:{y:0},ease:Power2.easeOut}))}}]),app.run(function($rootScope){$rootScope.$on("$stateChangeSuccess",function(event,toState){if("index"==toState.name){document.querySelector("title").innerHTML="Johan Bisse Mattsson";var content=document.getElementById("content"),contentRectangle=content.getBoundingClientRect();TweenMax.to(".site-title",1,{x:contentRectangle.left,y:12,ease:Elastic.easeOut})}else"post"==toState.name&&(TweenMax.to(".site-title",1,{color:"#00ff00"}),TweenMax.to(".site-title",1,{x:0,y:-32,ease:Elastic.easeOut}))})}),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/",sticky:!0,resolve:{indexTemplateCache:function($templateRequest){return $templateRequest("indexview.html")},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.indexInitialized()?void 0:(console.log("index initialiseras!!!"),stateStatusService.dataFromJSON(!0),stateStatusService.indexInitialized(!0),wpService.getIndex())}},views:{"indexView@":{templateProvider:function(indexTemplateCache){return indexTemplateCache},controller:"IndexController"}}}).state("index.animationFinished",{views:{"postView@":{template:"</ui-view>"}}}).state("post",{url:"/:slug/",sticky:!0,resolve:{postTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?(console.log("get postview.html (json)"),$templateRequest("postview.html")):(console.log("get postview-initialcontent.html (php)"),$templateRequest("postview-initialcontent.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getPost($stateParams.slug):void stateStatusService.dataFromJSON(!0)}},views:{"postView@":{templateProvider:function(postTemplateCacheOrInitialContent){return postTemplateCacheOrInitialContent},controller:"PostController"}}})}),app.controller("IndexController",["$scope","promiseObj","$state","$timeout","$anchorScroll","stateStatusService",function($scope,promiseObj,$state,$timeout,$anchorScroll,stateStatusService){function onFadeoutStart(){}function onFadeoutComplete(){$state.go("index.animationFinished")}promiseObj&&($scope.data=promiseObj),$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){if("post"==fromState.name&&"index"==toState.name){var tlFadeoutPost=new TimelineMax({onStart:onFadeoutStart,onComplete:onFadeoutComplete});tlFadeoutPost.set(".post-view article",{overflow:"hidden"}),tlFadeoutPost.set("body",{className:"index"}),tlFadeoutPost.set(".post-view article",{backgroundColor:"rgba(255,255,255, 0)"}),tlFadeoutPost.to(".post-view article",.33,{autoAlpha:0})}}),$scope.isSelected=function(postitem){return $scope.selected===postitem},$scope.onPostItemClick=function(postitem){$scope.selected=postitem,console.log(postitem);var indexFeaturedImageElement=$(".attachment-"+postitem.slug+"-thumbnail"),indexFeaturedImage={src:postitem.featured_image.source,width:indexFeaturedImageElement.width(),height:indexFeaturedImageElement.height(),x:indexFeaturedImageElement.position().left,y:indexFeaturedImageElement.position().top};stateStatusService.featuredImageData(indexFeaturedImage),console.log(indexFeaturedImage)}}]),app.controller("PostController",["$scope","promiseObj","$state","stateStatusService",function($scope,promiseObj,$state,stateStatusService){function onFadeinStart(){TweenMax.set(".post-view article",{overflow:"auto"}),TweenMax.set("body",{className:"single"})}function onFadeinComplete(){}promiseObj&&($scope.data=promiseObj),$scope.$on("$viewContentLoaded",function(){var tlFadeinPost=new TimelineMax({onStart:onFadeinStart,onComplete:onFadeinComplete});if(stateStatusService.featuredImageData()){{var postFeaturedImageContainer=(stateStatusService.featuredImageData(),$(".featured-image")),postFeaturedImageElement=$(".featured-image img");({top:postFeaturedImageElement.position().top,width:postFeaturedImageContainer.width()})}element=$(".featured-image")[0];var elemRect=(document.body.getBoundingClientRect(),element.getBoundingClientRect()),temp=elemRect.top;tlFadeinPost.fromTo(".animate-featured-image",.5,{top:stateStatusService.featuredImageData().y,left:stateStatusService.featuredImageData().x,width:stateStatusService.featuredImageData().width},{top:temp,left:elemRect.left}),console.log(temp)}tlFadeinPost.fromTo(".post-view article",1,{backgroundColor:"rgba(255,255,255, 0)"},{backgroundColor:"rgba(255,255,255, 1)"})})}]),app.factory("resourceCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("resourceCache")}]),app.factory("wpService",["$http","$q","$stateParams","resourceCache",function($http,$q,$stateParams,resourceCache){var wpService={post:[],posts:[],pages:[],home:[]};return wpService.getIndex=function(){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(resindex){angular.forEach(resindex,function(postvalue,postkey){"Home"==resindex[postkey].title?wpService.home=resindex[postkey]:resindex[postkey].slug==$stateParams.slug&&(wpService.posts=resindex[postkey])});for(var i=resindex.length-1;i>=0;i--)"post"!=resindex[i].type&&resindex.splice(i,1);wpService.posts=resindex}).then(function(){return wpService})},wpService.getPost=function(slug){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(respost){angular.forEach(respost,function(postvalue,postkey){respost[postkey].slug==slug&&(wpService.post=respost[postkey],document.querySelector("title").innerHTML=respost[postkey].title+" | Johan Bisse Mattsson")})}).then(function(){return wpService})},wpService}]),app.service("stateStatusService",function(){var stringStartState,stringCurrentState,arrayFeaturedImageData,boolDataFromJSON=!1,boolIndexLoaded=!1,boolSaveScroll=!0,intScrollPos=0,boolStringInitialized=!1,varrenameThis=0,boolfadeOutPostView=!1;return{startState:function(value){return value?void(stringStartState=value):stringStartState},dataFromJSON:function(value){return value?void(boolDataFromJSON=value):boolDataFromJSON},indexLoaded:function(value){return value?void(boolIndexLoaded=value):boolIndexLoaded},saveScroll:function(value){return value?void(boolSaveScroll=value):boolSaveScroll},scrollPos:function(value){return value?void(intScrollPos=value):intScrollPos},indexInitialized:function(value){return value?void(boolStringInitialized=value):boolStringInitialized},renameThis:function(value){return value?void(varrenameThis=value):varrenameThis},currentState:function(value){return value?void(stringCurrentState=value):stringCurrentState},fadeOutPostView:function(value){return value?void(boolfadeOutPostView=value):boolfadeOutPostView},featuredImageData:function(array){return array?void(arrayFeaturedImageData=array):arrayFeaturedImageData}}});
