var app=angular.module("app",["ngRoute","ngSanitize","ngAnimate","angular-images-loaded"]).controller("MainController");app.directive("contentView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent.html",element.html())}}}]),app.directive("onLastRepeat",function(){return function(scope,element,attrs){scope.$last&&setTimeout(function(){scope.$emit("onRepeatLast",element,attrs)},1)}}),app.run(function($templateCache,$http,resourceCache){$templateCache.put("main.html",'<div class="site-description" ng-bind-html="home.content"></div><div class="grid"><div class="grid-sizer"></div><div class="gutter-sizer"></div><div class="grid-item" ng-repeat="postitem in posts" on-last-repeat><a href="{{postitem.slug}}/" rel="bookmark"><img width="{{postitem.featured_image.attachment_meta.width}}" height="{{postitem.featured_image.attachment_meta.height}}" src="{{postitem.featured_image.source}}" alt="{{postitem.title}}"><h1 class="entry-title">{{postitem.title}}</h1><div class="entry-details">{{postitem.acf.entry_details}}</div></a></div></div>'),$templateCache.put("content.html",'<article id="post-{{post.ID}}" class="post-{{post.ID}} {{post.type}} type-{{post.type}}"><header class="entry-header"><h1 class="entry-title">{{post.title}}</h1><div class="entry-details">{{post.acf.entry_details}}</div></header><div class="entry-content" ng-bind-html="post.content"></div></article>'),$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache})}),app.config(function($routeProvider,$locationProvider){var initialized=!1;$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:function(){return initialized?"main.html":(initialized=!0,"initialcontent.html")},controller:"IndexController"}).when("/:slug/",{templateUrl:function(){return initialized?"content.html":(initialized=!0,"initialcontent.html")},controller:"ContentController"})}),app.controller("MainController",function($scope,$location,$timeout){$scope.imgLoadedEvents={always:function(){},done:function(){new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})},fail:function(){}},$scope.scrollPos={},$(window).on("scroll",function(){$scope.okSaveScroll&&($scope.scrollPos[$location.path()]=$(window).scrollTop())}),$scope.scrollClear=function(path){$scope.scrollPos[path]=0},$scope.$on("$routeChangeStart",function(){$scope.okSaveScroll=!1}),$scope.$on("$routeChangeSuccess",function(){$timeout(function(){$(window).scrollTop($scope.scrollPos[$location.path()]?$scope.scrollPos[$location.path()]:0),$scope.okSaveScroll=!0},100)})}),app.controller("IndexController",function($scope,$rootScope,$http,$routeParams,resourceCache){$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){"Home"==res[postkey].title?($scope.home=res[postkey],document.querySelector("title").innerHTML="Johan Bisse Mattsson"):res[postkey].slug==$routeParams.slug&&($scope.post=res[postkey])}),$scope.imgLoadedEvents={always:function(){},done:function(){new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})},fail:function(){}},$scope.posts=res.filter(function(obj){return"type"in obj&&"post"!=obj.type?!1:!0})}),$scope.$on("onRepeatLast",function(){imagesLoaded(".grid",function(){new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})})})}),app.controller("ContentController",function($scope,$http,$routeParams,resourceCache){$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){res[postkey].slug==$routeParams.slug?($scope.post=res[postkey],document.querySelector("title").innerHTML=res[postkey].title+" | Johan Bisse Mattsson"):"Home"==res[postkey].title&&($scope.home=res[postkey])})})}),app.factory("resourceCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("resourceCache")}]),app.directive("preloadResource",["resourceCache",function(resourceCache){return{link:function(scope,element,attrs){resourceCache.put(attrs.preloadResource,element.html())}}}]);
