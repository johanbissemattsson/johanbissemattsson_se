var app=angular.module("app",["ui.router","ngSanitize","ngAnimate","angular-images-loaded"]).controller("MainController");app.directive("indexView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent-indexview.html",element.html())}}}]),app.directive("postView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent-postview.html",element.html())}}}]),app.directive("preloadResource",["resourceCache",function(resourceCache){return{link:function(scope,element,attrs){resourceCache.put(attrs.preloadResource,element.html())}}}]),app.directive("onLastRepeat",function(){return function(scope,element,attrs){scope.$last&&setTimeout(function(){scope.$emit("onRepeatLast",element,attrs)},1)}}),app.run(function($templateCache,$http,resourceCache){$templateCache.put("indexview.html",'<p>Från indexview.html</p><div class="site-description" ng-bind-html="data.home.content"></div><div class="grid"><div class="grid-sizer"></div><div class="gutter-sizer"></div><div class="grid-item" ng-repeat="postitem in data.posts" on-last-repeat><a href="{{data.postitem.link}}" rel="bookmark"><img width="{{data.postitem.featured_image.attachment_meta.width}}" height="{{data.postitem.featured_image.attachment_meta.height}}" src="{{data.postitem.featured_image.source}}" alt="{{data.postitem.title}}"><h1 class="entry-title">{{data.postitem.title}}</h1><div class="entry-details">{{data.postitem.acf.entry_details}}</div></a></div></div>'),$templateCache.put("postview.html",'<p>Från postview.html</p><article id="post-{{data.post.ID}}" class="post-{{data.post.ID}} {{data.post.type}} type-{{data.post.type}}"><header class="entry-header"><h1 class="entry-title">{{data.post.title}}</h1><div class="entry-details">{{data.post.acf.entry_details}}</div></header><div class="entry-content" ng-bind-html="data.post.content"></div></article>'),$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache})}),app.controller("MainController",["$scope","$rootScope","$state","$location","$timeout","$anchorScroll","stateStatusService",function($scope,$rootScope,$state,$location,$timeout,$anchorScroll,stateStatusService){$rootScope.$on("$stateChangeSuccess",function(event,toState){$state.current=toState,"index"==toState.name?($scope.postView=!1,stateStatusService.indexLoaded(!0)):($scope.postView=!0,console.log("JENGIJENGJE"))}),$scope.imgLoadedEvents={always:function(){},done:function(){new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})},fail:function(){}},$scope.gotoTop=function(){$scope.currentPath=$location.path(),"/"==$scope.currentPath&&($rootScope.scrollPos=0,$("html,body").animate({scrollTop:$rootScope.scrollPos},500))}}]),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/",resolve:{indexTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?stateStatusService.indexLoaded()?void console.log("Index already has been loaded so skip resolve part"):(console.log("get indexview.html (json)"),$templateRequest("indexview.html")):(console.log("get initialcontent-indexview.html (php)"),$templateRequest("initialcontent-indexview.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getIndex():(console.log("initDataFromJSON (index state)"),void stateStatusService.initDataFromJSON())}},views:{"indexView@":{templateProvider:function(indexTemplateCacheOrInitialContent,stateStatusService){return stateStatusService.indexLoaded()?void console.log("Index already has been loaded so skip view part"):(console.log("IndexLoaded: "+stateStatusService.indexLoaded()),indexTemplateCacheOrInitialContent)},controller:"IndexController"}}}).state("post",{url:"/:slug/",resolve:{postTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?(console.log("get postview.html (json)"),$templateRequest("postview.html")):(console.log("get initialcontent-postview.html (php)"),$templateRequest("initialcontent-postview.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getPost($stateParams.slug):(console.log("initDataFromJSON (post state)"),void stateStatusService.initDataFromJSON())}},views:{"postView@":{templateProvider:function(postTemplateCacheOrInitialContent){return postTemplateCacheOrInitialContent},controller:"PostController"}}})}),app.controller("IndexController",["$scope","promiseObj",function($scope,promiseObj){$("body").removeClass("single"),promiseObj&&($scope.data=promiseObj)}]),app.controller("PostController",["$scope","promiseObj",function($scope,promiseObj){$("body").addClass("single"),promiseObj&&($scope.data=promiseObj)}]),app.factory("resourceCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("resourceCache")}]),app.factory("wpService",["$http","$q","$stateParams","resourceCache",function($http,$q,$stateParams,resourceCache){var wpService={post:[],posts:[],pages:[],home:[]};return wpService.getIndex=function(){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){"Home"==res[postkey].title?(wpService.home=res[postkey],document.querySelector("title").innerHTML="Johan Bisse Mattsson"):res[postkey].slug==$stateParams.slug&&(wpService.posts=res[postkey])}),wpService.posts=res}).then(function(){return wpService})},wpService.getPost=function(slug){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(res){angular.forEach(res,function(postvalue,postkey){res[postkey].slug==slug&&(wpService.post=res[postkey],document.querySelector("title").innerHTML=res[postkey].title+" | Johan Bisse Mattsson")})}).then(function(){return wpService})},wpService}]),app.service("stateStatusService",function(){var stringStartState,boolDataFromJSON=!1,boolIndexLoaded=!1;return{startState:function(value){return stringStartState=value},dataFromJSON:function(){return boolDataFromJSON},initDataFromJSON:function(){boolDataFromJSON=!0},indexLoaded:function(value){return value?void(boolIndexLoaded=value):boolIndexLoaded}}});
