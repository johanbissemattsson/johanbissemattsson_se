var app=angular.module("app",["ui.router","ct.ui.router.extras","ngSanitize","angular-images-loaded"]).controller("MainController");app.directive("contentView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("initialcontent.html",element.html())}}}]),app.directive("indexView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("indexview-initialcontent.html",element.html())}}}]),app.directive("postView",["$templateCache",function($templateCache){return{restrict:"A",compile:function(element){$templateCache.put("postview-initialcontent.html",element.html())}}}]),app.directive("preloadResource",["resourceCache",function(resourceCache){return{link:function(scope,element,attrs){resourceCache.put(attrs.preloadResource,element.html())}}}]),app.directive("onLastRepeat",function(){return function(scope,element,attrs){scope.$last&&setTimeout(function(){scope.$emit("onRepeatLast",element,attrs)},1)}}),app.run(function($templateCache,$http,resourceCache){$templateCache.put("indexview.html",'<div class="site-description" ng-bind-html="data.home.content"></div><div class="grid effect" images-loaded="imgLoadedEvents"><div class="grid-sizer"></div><div class="gutter-sizer"></div><div class="grid-item" ng-repeat="postitem in data.posts" on-last-repeat><a href="{{postitem.link}}" rel="bookmark"><img ng-src="{{postitem.featured_image.source}}" width="{{postitem.featured_image.attachment_meta.width}}" height="{{postitem.featured_image.attachment_meta.height}}" alt="{{postitem.title}}"><h1 class="entry-title">{{postitem.title}}</h1><div class="entry-details">{{postitem.acf.entry_details}}</div></a></div>'),$templateCache.put("postview.html",'<article id="post-{{data.post.ID}}" class="post-{{data.post.ID}} {{data.post.type}} type-{{data.post.type}}"><header class="entry-header"><h1 class="entry-title">{{data.post.title}}</h1><div class="entry-details">{{data.post.acf.entry_details}}</div></header><div class="entry-content" ng-bind-html="data.post.content"></div></article>'),$http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache})}),app.controller("MainController",["$scope","$rootScope","$state","$location","$timeout","$anchorScroll","stateStatusService",function($scope,$rootScope,$state,$location,$timeout,$anchorScroll,stateStatusService){$scope.imgLoadedEvents={always:function(){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded");new Isotope(".grid",{percentPosition:"true",itemSelector:".grid-item",layoutMode:"masonry",transitionDuration:"0",masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}})},fail:function(){}},$scope.gotoTop=function(){$scope.currentPath=$location.path(),"/"==$scope.currentPath&&(stateStatusService.scrollPos(0),$("html,body").animate({scrollTop:0},500))}}]),app.run(function($rootScope){$rootScope.$on("$stateChangeSuccess",function(event,toState){"index"==toState.name&&(document.querySelector("title").innerHTML="Johan Bisse Mattsson",$("body").removeClass("single").addClass("index"))})}),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/",sticky:!0,resolve:{indexTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?(console.log("get indexview.html (json)"),$templateRequest("indexview.html")):(console.log("get initialcontent.html (php)"),$templateRequest("indexview-initialcontent.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?(stateStatusService.indexInitialized(!0),wpService.getIndex()):(stateStatusService.dataFromJSON(!0),void stateStatusService.indexInitialized(!0))}},views:{"indexView@":{templateProvider:function(indexTemplateCacheOrInitialContent){return indexTemplateCacheOrInitialContent},controller:"IndexController"},"postView@":{template:"</ui-view>"}}}).state("post",{url:"/:slug/",resolve:{postTemplateCacheOrInitialContent:function($templateRequest,stateStatusService){return stateStatusService.dataFromJSON()?(console.log("get postview.html (json)"),$templateRequest("postview.html")):(console.log("get initialcontent.html (php)"),$templateRequest("postview-initialcontent.html"))},promiseObj:function($stateParams,resourceCache,stateStatusService,wpService){return stateStatusService.dataFromJSON()?wpService.getPost($stateParams.slug):(console.log("initDataFromJSON (post state)"),void stateStatusService.dataFromJSON(!0))}},views:{"postView@":{templateProvider:function(postTemplateCacheOrInitialContent){return postTemplateCacheOrInitialContent},controller:"PostController"}}})}),app.controller("IndexController",["$scope","promiseObj","$timeout","$anchorScroll","stateStatusService",function($scope,promiseObj){promiseObj&&($scope.data=promiseObj)}]),app.controller("PostController",["$scope","promiseObj",function($scope,promiseObj){promiseObj&&($scope.data=promiseObj),$scope.$on("$viewContentLoaded",function(){$("body").removeClass("index").addClass("single")})}]),app.factory("resourceCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("resourceCache")}]),app.factory("wpService",["$http","$q","$stateParams","resourceCache",function($http,$q,$stateParams,resourceCache){var wpService={post:[],posts:[],pages:[],home:[]};return wpService.getIndex=function(){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(resindex){angular.forEach(resindex,function(postvalue,postkey){"Home"==resindex[postkey].title?wpService.home=resindex[postkey]:resindex[postkey].slug==$stateParams.slug&&(wpService.posts=resindex[postkey])});for(var i=resindex.length-1;i>=0;i--)"post"!=resindex[i].type&&resindex.splice(i,1);wpService.posts=resindex}).then(function(){return wpService})},wpService.getPost=function(slug){return $http.get("wp-content/uploads/json/sitedata.json",{cache:resourceCache}).success(function(respost){angular.forEach(respost,function(postvalue,postkey){respost[postkey].slug==slug&&(wpService.post=respost[postkey],document.querySelector("title").innerHTML=respost[postkey].title+" | Johan Bisse Mattsson")})}).then(function(){return wpService})},wpService}]),app.service("stateStatusService",function(){var stringStartState,boolDataFromJSON=!1,boolIndexLoaded=!1,boolSaveScroll=!0,intScrollPos=0,boolStringInitialized=!1,varrenameThis=0;return{startState:function(value){return value?void(stringStartState=value):stringStartState},dataFromJSON:function(value){return value?void(boolDataFromJSON=value):boolDataFromJSON},indexLoaded:function(value){return value?void(boolIndexLoaded=value):boolIndexLoaded},saveScroll:function(value){return value?void(boolSaveScroll=value):boolSaveScroll},scrollPos:function(value){return value?void(intScrollPos=value):intScrollPos},indexInitialized:function(value){return value?void(boolStringInitialized=value):boolStringInitialized},renameThis:function(value){return value?void(varrenameThis=value):varrenameThis}}});
